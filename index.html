<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>宿題管理</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <p>読み込み中...</p>

<script>
(async () => {
  await liff.init({ liffId: "YOUR_LIFF_ID" });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const userId = liff.getDecodedIDToken().sub;

  const res = await fetch(location.origin + location.pathname, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "checkUser",
      userId
    })
  });

  const data = await res.json();

  if (data.registered) {
    location.href = "?page=add";
  } else {
    location.href = "?page=register";
  }
})();
</script>
</body>
</html>
