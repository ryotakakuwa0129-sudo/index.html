<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ユーザー登録</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body{font-family:sans-serif;text-align:center;padding:20px;}
button{padding:10px 20px;margin:10px;font-size:16px;}
.fade-in{animation:fadeIn 0.5s;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
</style>
</head>
<body class="fade-in">
<h2>ユーザー登録</h2>
<p>下のボタンを押すと登録されます</p>
<button id="registerBtn">登録する</button>

<script>
let liffId = "YOUR_LIFF_ID"; // ここにLIFF IDを設定

async function main() {
  await liff.init({ liffId });
  const userId = liff.getContext().userId;

  // 登録済みなら自動で閉じる
  const res = await fetch(liff.getOS()+'/liffApi',{ 
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'checkUser', userId })
  });
  const data = await res.json();
  if(data.registered){ liff.closeWindow(); }
}

document.getElementById('registerBtn').addEventListener('click', async()=>{
  const userId = liff.getContext().userId;
  await fetch(liff.getOS()+'/liffApi',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'register', userId })
  });
  alert('登録完了！');
  liff.closeWindow();
});

main();
</script>
</body>
</html>
