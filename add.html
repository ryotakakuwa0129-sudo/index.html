<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>宿題追加</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body { font-family: sans-serif; padding: 12px; }
  button { margin: 4px 2px; padding: 8px 12px; }
  .subject-btn { display: inline-block; margin: 4px; }
</style>
</head>
<body>
<h2>➕ 宿題追加</h2>

<div>
  <p>教科を選択:</p>
  <div id="subjects">
    <button class="subject-btn" data-subject="国語">国語</button>
    <button class="subject-btn" data-subject="数学">数学</button>
    <button class="subject-btn" data-subject="英語">英語</button>
    <button class="subject-btn" data-subject="理科">理科</button>
    <button class="subject-btn" data-subject="社会">社会</button>
    <button class="subject-btn" data-subject="音楽">音楽</button>
    <button class="subject-btn" data-subject="美術">美術</button>
    <button class="subject-btn" data-subject="保体">保体</button>
    <button class="subject-btn" data-subject="その他">その他</button>
  </div>
</div>

<div>
  <input id="text" placeholder="宿題内容" style="width: 100%; margin-top: 8px;"><br>
  <input id="date" type="date" style="margin-top: 8px;"><br>
  <button id="addBtn" style="margin-top: 8px;">追加</button>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbz910FJbvEKdMV-8dEGncfx2YocZHmNVeuyZHRA26c6SmqEaBEgPzwURfl1fQonvpTbpQ/exec";
const LIFF_ID = "2008725002-jHJsEKRx";

let userId = "";
let selectedSubject = "";

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) liff.login();
  userId = liff.getContext().userId;

  document.querySelectorAll('.subject-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      selectedSubject = btn.dataset.subject;
      document.querySelectorAll('.subject-btn').forEach(b => b.style.backgroundColor = '');
      btn.style.backgroundColor = '#cce5ff';
    });
  });

  document.getElementById('addBtn').addEventListener('click', addHomework);
}

async function post(data) {
  const res = await fetch(GAS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  return res.json();
}

async function addHomework() {
  const text = document.getElementById('text').value;
  const date = document.getElementById('date').value;

  if (!selectedSubject) { alert("教科を選んでください"); return; }
  if (!text || !date) { alert("内容と期限を入力してください"); return; }

  await post({
    action: "addHomework",
    userId,
    subject: selectedSubject,
    text,
    date
  });

  alert("宿題を追加しました！");
  liff.closeWindow();
}

init();
</script>
</body>
</html>

