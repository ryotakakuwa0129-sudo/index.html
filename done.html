<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>宿題完了</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>未完了宿題</h2>
  <div id="list"></div>
  <button id="doneBtn">完了にする</button>

<script>
let undone = [];

(async () => {
  await liff.init({ liffId: "2008725002-jHJsEKRx" });
  const userId = liff.getDecodedIDToken().sub;

  const res = await fetch(location.origin + location.pathname, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "getUndoneHomework",
      userId
    })
  });

  undone = await res.json();

  const list = document.getElementById("list");
  undone.forEach((t, i) => {
    list.innerHTML += `
      <label>
        <input type="checkbox" value="${t}">
        ${t}
      </label><br>
    `;
  });
})();

document.getElementById("doneBtn").onclick = async () => {
  const checked = [...document.querySelectorAll("input:checked")]
    .map(c => c.value);

  const userId = liff.getDecodedIDToken().sub;

  await fetch(location.origin + location.pathname, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "doneHomework",
      userId,
      doneList: checked
    })
  });

  alert("完了しました");
  location.reload();
};
</script>
</body>
</html>


